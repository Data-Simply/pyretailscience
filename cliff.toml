# git-cliff configuration for PyRetailScience
# Documentation: https://git-cliff.org/docs/configuration

[changelog]
# Header template for the changelog
header = """
# Changelog

All notable changes to PyRetailScience will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

"""

# Body template for each release
body = """
{% if version %}\
    ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
    ## [Unreleased]
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | striptags | trim | upper_first }}
    {% for commit in commits %}
        - {% if commit.scope %}**{{ commit.scope }}**: {% endif %}\
            {{ commit.message | upper_first }}\
            {% if commit.breaking %} [**BREAKING**]{% endif %}\
    {% endfor %}
{% endfor %}\n
"""

# Footer template
footer = """
<!-- generated by git-cliff -->
"""

# Remove the leading and trailing whitespace from the templates
trim = true

[git]
# Parse conventional commits
conventional_commits = true

# Filter out unconventional commits
filter_unconventional = true

# Process each line of a commit message
split_commits = false

# Protect breaking changes from being skipped due to matching a skipping commit_parser
protect_breaking_commits = false

# Filter out commits that are not matched by commit parsers
filter_commits = true

# Glob pattern for matching git tags
tag_pattern = "v[0-9]*"

# Skip tags with -rc, -alpha, -beta suffixes
skip_tags = "v[0-9]+\\.[0-9]+\\.[0-9]+-.*"

# Ignore tags that match this regex
ignore_tags = ""

# Sort tags in reverse order (newest first)
topo_order = false

# Sort commits inside sections by oldest/newest
sort_commits = "oldest"

# Limit the number of commits included in the changelog
# limit_commits = 42

[git.commit_parsers]
# Parse and classify commits based on their prefix
message = "^feat"
group = "Features"

[[git.commit_parsers]]
message = "^fix"
group = "Bug Fixes"

[[git.commit_parsers]]
message = "^docs"
group = "Documentation"

[[git.commit_parsers]]
message = "^perf"
group = "Performance"

[[git.commit_parsers]]
message = "^refactor"
group = "Refactoring"

[[git.commit_parsers]]
message = "^style"
group = "Styling"

[[git.commit_parsers]]
message = "^test"
group = "Testing"

[[git.commit_parsers]]
message = "^chore\\(release\\): prepare for"
skip = true

[[git.commit_parsers]]
message = "^chore\\(deps.*\\)"
skip = true

[[git.commit_parsers]]
message = "^chore\\(pr\\)"
skip = true

[[git.commit_parsers]]
message = "^chore\\(pull\\)"
skip = true

[[git.commit_parsers]]
message = "^chore"
group = "Miscellaneous Tasks"
skip = true

[[git.commit_parsers]]
message = "^ci"
group = "CI/CD"
skip = true

[[git.commit_parsers]]
message = "^build"
group = "Build System"
skip = true

[[git.commit_parsers]]
message = "^revert"
group = "Reverts"

# Protect breaking changes - these should never be skipped
[[git.commit_parsers]]
body = ".*BREAKING[ -]CHANGE.*"
group = "Breaking Changes"

[git.commit_preprocessors]
# Replace issue numbers with links
{ pattern = '\((\w+\s)?#([0-9]+)\)', replace = "([#${2}](https://github.com/Data-Simply/pyretailscience/issues/${2}))" }

# Link to PRs
{ pattern = "Merge pull request #([0-9]+)", replace = "PR [#${1}](https://github.com/Data-Simply/pyretailscience/pull/${1})" }

[remote.github]
owner = "Data-Simply"
repo = "pyretailscience"
token = ""  # Can be set via GITHUB_TOKEN env var
