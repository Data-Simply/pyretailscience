services:
  spark:
    image: apache/spark-py:latest
    container_name: pyspark-integration-tests
    user: root
    volumes:
      - ../../../data:/app/data
      - ../../..:/app/work
    working_dir: /app/work
    environment:
      - SPARK_DRIVER_MEMORY=512m
      - SPARK_EXECUTOR_MEMORY=512m
      - UV_LINK_MODE=copy
      - PYTHONPATH=/opt/spark/python:/opt/spark/python/lib/py4j-0.10.9.7-src.zip
      - SPARK_HOME=/opt/spark
    command: >
      bash -c "
      pip3 install py4j==0.10.9.7 uv==0.5.30 &&
      cd /app/work &&
      uv sync --group dev --link-mode=copy &&
      tail -f /dev/null
      "
